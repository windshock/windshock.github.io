{{- /* Footer custom content area start */ -}}
{{- /*     Insert any custom code web-analytics, resources, etc. here */ -}}
{{ $url := .Permalink }}
{{ if (and (strings.Contains $url "/post/") .Site.Params.giscus.repo) }}
<script>
  function loadGiscus(theme) {
    // ê¸°ì¡´ Giscus iframe + script ì œê±°
    document.querySelectorAll('.giscus-frame, script[src*="giscus.app"]').forEach(el => el.remove());

    // ìƒˆë¡œìš´ Giscus ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
    const giscusScript = document.createElement("script");
    giscusScript.src = "https://giscus.app/client.js";
    giscusScript.setAttribute("data-repo", "{{ .Site.Params.giscus.repo }}");
    giscusScript.setAttribute("data-repo-id", "{{ .Site.Params.giscus.repo_id }}");
    giscusScript.setAttribute("data-category", "{{ .Site.Params.giscus.category }}");
    giscusScript.setAttribute("data-category-id", "{{ .Site.Params.giscus.category_id }}");
    giscusScript.setAttribute("data-mapping", "{{ .Site.Params.giscus.mapping }}");
    giscusScript.setAttribute("data-reactions-enabled", "{{ .Site.Params.giscus.reactions_enabled }}");
    giscusScript.setAttribute("data-theme", theme); // ðŸ‘ˆ ë‹¤í¬/ë¼ì´íŠ¸ ë°˜ì˜
    giscusScript.setAttribute("data-lang", "{{ .Site.Params.giscus.lang }}");
    giscusScript.setAttribute("data-input-position", "{{ .Site.Params.giscus.input_position }}");
    giscusScript.setAttribute("data-loading", "{{ .Site.Params.giscus.loading }}");
    giscusScript.crossOrigin = "anonymous";
    giscusScript.async = true;

    document.body.appendChild(giscusScript);
  }

  // ìµœì´ˆ ë¡œë”© ì‹œ ì ìš©
  const currentTheme = document.body.classList.contains("dark") ? "dark" : "light";
  loadGiscus(currentTheme);

  // í…Œë§ˆ ì „í™˜ ê°ì§€ â†’ ë‹¤ì‹œ Giscus ë¡œë“œ
  const observer = new MutationObserver(() => {
    const newTheme = document.body.classList.contains("dark") ? "dark" : "light";
    loadGiscus(newTheme);
  });

  observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });
</script>

{{ end }}

<script>
  function initSwiperIfNeeded() {
    if (typeof Swiper === 'undefined') {
      // âœ… Swiper ê°ì²´ê°€ ì•„ì§ ì—†ìœ¼ë©´ ë‹¤ì‹œ ëŒ€ê¸°
      return setTimeout(initSwiperIfNeeded, 50);
    }

    if (document.querySelector('.swiper')) {
      new Swiper('.swiper', {
        slidesPerView: 1.2,
        spaceBetween: 16,
        loop: true,
        preloadImages: false,
        lazy: {
          loadOnTransitionStart: true,
          loadPrevNext: true,
        },
        pagination: {
          el: '.swiper-pagination',
          clickable: true
        },
        breakpoints: {
          768: { slidesPerView: 2.5 },
          1024: { slidesPerView: 3.2 }
        }
      });

      // âœ… Lazy ê°•ì œ ì ìš©
      document.querySelectorAll('img.swiper-lazy').forEach(img => {
        img.src = img.dataset.src;
      });
    } else {
      setTimeout(initSwiperIfNeeded, 100);
    }
  }

  // ì¦‰ì‹œ ì‹¤í–‰
  initSwiperIfNeeded();
</script>

{{- /* Footer custom content area end */ -}}
