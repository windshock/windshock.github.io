<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Detection Frameworks and Latest Methodologies for eBPF-Based Backdoors | Code Before Breach</title>
<meta name=keywords content="eBPF,Rootkit Detection,BPFDoor,Kernel Security,Tracee,LKRG,Hypervisor Audit,Forensics"><meta name=description content="This article analyzes the rise of backdoors and rootkits exploiting eBPF, the detection challenges they pose, and comprehensively summarizes the latest countermeasures and research trends (2023–2025), including Tracee, LKRG, bpftool, and hypervisor-based auditing."><meta name=author content><link rel=canonical href=https://windshock.github.io/en/post/2025-04-29-ebpf-backdoor-detection-framework/><link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;700&display=swap" rel=stylesheet><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://windshock.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://windshock.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://windshock.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://windshock.github.io/apple-touch-icon.png><link rel=mask-icon href=https://windshock.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://windshock.github.io/en/post/2025-04-29-ebpf-backdoor-detection-framework/><link rel=alternate hreflang=ko href=https://windshock.github.io/ko/post/2025-04-29-ebpf-backdoor-detection-framework/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css><script defer src=https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js></script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-6N6EEJ259T"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6N6EEJ259T")}</script><meta property="og:url" content="https://windshock.github.io/en/post/2025-04-29-ebpf-backdoor-detection-framework/"><meta property="og:site_name" content="Code Before Breach"><meta property="og:title" content="Detection Frameworks and Latest Methodologies for eBPF-Based Backdoors"><meta property="og:description" content="This article analyzes the rise of backdoors and rootkits exploiting eBPF, the detection challenges they pose, and comprehensively summarizes the latest countermeasures and research trends (2023–2025), including Tracee, LKRG, bpftool, and hypervisor-based auditing."><meta property="og:locale" content="en-US"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2025-04-28T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-28T00:00:00+00:00"><meta property="article:tag" content="EBPF"><meta property="article:tag" content="Rootkit Detection"><meta property="article:tag" content="BPFDoor"><meta property="article:tag" content="Kernel Security"><meta property="article:tag" content="Tracee"><meta property="article:tag" content="LKRG"><meta name=twitter:card content="summary"><meta name=twitter:title content="Detection Frameworks and Latest Methodologies for eBPF-Based Backdoors"><meta name=twitter:description content="This article analyzes the rise of backdoors and rootkits exploiting eBPF, the detection challenges they pose, and comprehensively summarizes the latest countermeasures and research trends (2023–2025), including Tracee, LKRG, bpftool, and hypervisor-based auditing."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://windshock.github.io/en/post/"},{"@type":"ListItem","position":2,"name":"Detection Frameworks and Latest Methodologies for eBPF-Based Backdoors","item":"https://windshock.github.io/en/post/2025-04-29-ebpf-backdoor-detection-framework/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Detection Frameworks and Latest Methodologies for eBPF-Based Backdoors","name":"Detection Frameworks and Latest Methodologies for eBPF-Based Backdoors","description":"This article analyzes the rise of backdoors and rootkits exploiting eBPF, the detection challenges they pose, and comprehensively summarizes the latest countermeasures and research trends (2023–2025), including Tracee, LKRG, bpftool, and hypervisor-based auditing.","keywords":["eBPF","Rootkit Detection","BPFDoor","Kernel Security","Tracee","LKRG","Hypervisor Audit","Forensics"],"articleBody":"\nOverview: The Rise of eBPF Backdoors and Detection Challenges eBPF (extended BPF) is a powerful technology that allows dynamic injection of programs into the Linux kernel, originally intended for legitimate use cases such as performance monitoring and security enforcement​ (sysdig.com)​ (sysdig.com). However, in recent years, attackers have increasingly abused eBPF to develop backdoors and rootkits, making eBPF a double-edged sword in the security landscape​ (aquasec.com).\nSince 2023, several rootkits (ebpfkit, TripleCross) and malware (Pamspy) utilizing eBPF have emerged, enabling malicious activities such as credential theft and firewall evasion​ (aquasec.com).\nBecause eBPF-based backdoors operate at the kernel level, they are extremely difficult to detect and are often missed by traditional security tools​ (trendmicro.com)​ (redcanary.com).\nIn this article, we comprehensively summarize open detection frameworks, tools, the latest research trends, challenges, strategies, case studies, and practical utilities for dealing with eBPF-based backdoors.\nDetection Challenges of eBPF Backdoors eBPF backdoors are extremely difficult to detect using traditional rootkit detection methods.\nUnlike conventional kernel modules, eBPF programs do not appear as separate modules; instead, they execute inside the kernel’s BPF virtual machine, making them inherently stealthy.\nFor example, the BPFDoor backdoor used in APT attacks inserted packet filters into the kernel to bypass firewall rules while masquerading as if no network ports were open​ (trendmicro.com).\nOnce an eBPF rootkit is installed, it can even manipulate the outputs of system diagnostic tools to hide its presence​ (redcanary.com).\nAccording to Red Canary’s analysis, once loaded, eBPF malware can stealthily alter results from tools like bpftool and debugfs, making post-compromise detection extremely difficult​ (redcanary.com).\nThus, if detection fails at the loading stage, identifying the backdoor afterward becomes extremely challenging—this is the core difficulty in detecting eBPF backdoors​ (redcanary.com).\nTo overcome these challenges, a strategy combining real-time monitoring and post-incident forensic techniques is essential.\nFor example, kernel-level monitoring tools that intercept eBPF program loading events can detect malicious eBPF activity at its inception​ (scitepress.org).\nConversely, if a rootkit is already active, hypervisor-based or memory forensic approaches must be employed to examine kernel memory externally​ (scitepress.org).\nBelow, we will explore these real-time detection frameworks and research-driven methodologies, analyzing their characteristics and limitations in detail.\nWhy Linux Anti-Virus Cannot Cover eBPF Backdoors Conclusion:\nGeneral-purpose Linux anti-virus solutions cannot detect or block eBPF-based backdoors.\nKey Reasons eBPF backdoors are not file-based:\nTraditional Linux anti-virus tools are optimized for scanning malicious files in the file system.\nHowever, eBPF programs are loaded into the kernel’s BPF subsystem and are executed upon specific events, meaning they do not exist directly in the file system.\nInability to monitor internal kernel activities:\nConventional Linux AV solutions primarily monitor user-space processes and disk I/O activities.\neBPF programs operate within kernel space, far beyond the reach of traditional AV monitoring.\nPotential for information manipulation:\neBPF rootkits can tamper with system calls, process lists, and file lists.\nTherefore, the data seen by the AV scanner itself may already be forged.\nInability to detect BPF-level hooks:\nTraditional anti-virus scanners cannot capture kernel-level activities like system call table hooking, kprobe/uprobes attachment, or eBPF event interception.\nPractical Summary File-based malware (e.g., web shells, trojans): Detectable Kernel-space eBPF backdoors: Not detectable Kernel module-based rootkits: Not detectable “Linux antivirus solutions fundamentally cannot detect eBPF backdoors.\nWithout kernel-level integrity protection, no output can be trusted.”\nTherefore, the use of kernel integrity protection modules like LKRG (Linux Kernel Runtime Guard) is strongly recommended.\nTracee vs LKRG: Their Complementary Roles When addressing eBPF backdoors and kernel rootkits, Tracee and LKRG complement each other at different layers.\nAspect Tracee LKRG What is monitored? Kernel events (e.g., bpf calls, execve, open) Kernel object integrity (e.g., syscall table, credentials) When is monitoring performed? Detection upon the occurrence of attack events Detection upon attempts to tamper with kernel structures Detection focus System call level Kernel memory structure level Primary goal Threat hunting (detect anomalies) Integrity enforcement and protection Operation method Passive event logging and alerting Active prevention or alerting on integrity violations Nature Incident response-oriented Incident prevention-oriented Summary Tracee acts as a security camera, recording anomalous activities after they happen. LKRG serves as security bars, actively monitoring kernel structures and preventing tampering. “Using only Tracee records incidents but cannot block them.\nUsing only LKRG blocks tampering but leaves no forensic trail.\nUsing both together provides the strongest protection, combining detection and prevention.”\nSimple Script for Detecting BPFDoor-like Behavior: bpfdoor_detector.sh This is a lightweight script designed to detect processes exhibiting behaviors similar to the BPFDoor eBPF backdoor.\nScript Features Detects processes running with deleted executables ((deleted) state). Filters processes that are using BPF sockets. Excludes legitimate programs that use BPF, such as tcpdump, wireshark, and dhclient. Displays basic network connection information for suspicious processes. Usage sudo ./bpfdoor_detector.sh Must be run with root privileges. Required commands: ps, grep, readlink, ss Full Script Code #!/bin/bash # BPFDoor-like Suspicious Process Detector # Check for root permission if [ \"$(id -u)\" -ne 0 ]; then echo \"[!] This script must be run as root.\" exit 1 fi # Check required commands for cmd in ps grep readlink ss; do if ! command -v $cmd \u0026\u003e/dev/null; then echo \"[!] $cmd command is required. Please install it first.\" exit 1 fi done echo \"[*] Starting focused BPFDoor-like process detection...\" found=0 # Iterate over all PIDs for pid in $(ls /proc/ | grep -E '^[0-9]+$'); do [ -d \"/proc/$pid\" ] || continue exe_path=$(readlink /proc/$pid/exe 2\u003e/dev/null) if [[ $exe_path == *\"(deleted)\" ]]; then if [ -r /proc/$pid/net/packet ] \u0026\u0026 [ -s /proc/$pid/net/packet ]; then cmdline=$(ps -p $pid -o cmd= 2\u003e/dev/null) if [[ ! $cmdline =~ \"tcpdump|wireshark|dhclient\" ]]; then echo \"[!] Suspicious process detected:\" echo \" - PID: $pid\" echo \" - Command: $cmdline\" echo \" - Deleted executable: $exe_path\" echo \" - BPF socket is active\" ss -p -n 2\u003e/dev/null | grep \"pid=$pid,\" | awk '{print \" - Network: \" $0}' echo \"\" found=1 fi fi fi done [ $found -eq 0 ] \u0026\u0026 echo \"[*] No suspicious processes found.\" echo \"[*] Detection completed.\" Cautions This script provides only lightweight hints at the process level. Advanced eBPF rootkits can tamper with /proc, so relying solely on this script is not sufficient. It is strongly recommended to use this script in combination with kernel integrity protection modules like LKRG. Without kernel integrity protection like LKRG, even detection results may be forged.\nChecking for eBPF Backdoors in OpenStack Environments In OpenStack environments, you can directly inspect eBPF activities from the host OS (KVM Hypervisor).\nInspection Script Using bpftool #!/bin/bash # List all BPF programs echo \"[*] Listing currently loaded BPF programs...\" bpftool prog show # List all BPF maps echo \"[*] Listing currently loaded BPF maps...\" bpftool map show # Optional: Check for unexpected XDP attachments echo \"[*] Checking for XDP programs attached to network interfaces...\" for iface in $(ls /sys/class/net/); do ip link show dev \"$iface\" | grep -q \"xdp\" \u0026\u0026 echo \"[!] XDP attached: $iface\" done # Optional: Check for TC filters echo \"[*] Checking for TC filters...\" for iface in $(ls /sys/class/net/); do tc filter show dev \"$iface\" 2\u003e/dev/null | grep -i \"bpf\" \u0026\u0026 echo \"[!] BPF TC filter detected on: $iface\" done echo \"[*] BPF scan completed.\" Script Explanation bpftool prog show: Lists all currently loaded eBPF programs in the kernel. Essential for spotting potentially malicious BPF programs. bpftool map show: Lists all BPF maps. Malicious actors may exploit maps for C2 command control or session management. Checking XDP attachments: Use ip link show to check if any XDP programs are attached to network interfaces. XDP (eXpress Data Path) allows direct packet interception at the NIC (Layer 2) level and may be exploited by backdoors like BPFDoor to manipulate traffic stealthily. Checking TC (Traffic Control) filters: Use tc filter show to check if BPF-based traffic filters are applied to network interfaces. TC filters can be used to selectively manipulate network traffic. Summary:\nBy inspecting BPF programs, maps, XDP attachments, and TC filters, you can detect traces of eBPF backdoors early from the OpenStack host level.\nDealing with eBPF Backdoors in vSphere + VMware NSX Environments In vSphere (ESXi) environments, direct inspection inside guest OSs is difficult,\nbut NSX allows detection of abnormal behaviors at the network level.\nPossible Detection Strategies Method Description Using Distributed Firewall (DFW) Rules Detect or block unexpected outbound port usage or C2 server connection attempts. Activating NSX IDS/IPS Features Detect communication patterns similar to BPFDoor (e.g., abnormal UDP, ICMP tunneling). Using Flow Analytics Analyze East-West traffic between VMs to detect abnormal communication flows. Leveraging NSX Threat Intelligence If NSX ATP (Advanced Threat Protection) modules are enabled, detect known IOCs (Indicators of Compromise). Cautions NSX cannot detect internal kernel tampering. (Detection is purely from a network perspective.) Separate monitoring inside guest OSs is still necessary. (e.g., using Tracee, EDR, etc.) “In vSphere environments, the most effective approach is a dual-layered structure:\nuse NSX for network-level anomaly detection, and deploy separate runtime security tools inside guest OSs for kernel monitoring.”\nPublicly Available eBPF Backdoor Detection Frameworks and Tools Several open-source tools and frameworks have recently been developed to detect malicious eBPF activities.\nHere are key tools and their characteristics:\nTool/Framework Approach and Features Remarks Tracee (Aqua Security) An eBPF-based real-time monitoring tool that traces kernel events to detect malicious behaviors. Especially captures bpf_attach events at the moment an eBPF program attaches to a kprobe/tracepoint, recording ID, name, type, and used helper functions​ (scitepress.org)​ (aquasec.com). Open-source (available on GitHub). Developed by Aqua Security for detecting eBPF rootkits and malware. ebpfkit-monitor A specialized tool developed by Datadog researchers (Fournier) that statically analyzes eBPF bytecode or monitors execution to detect malicious eBPF loading​ (scitepress.org). Open-source (available on GitHub). Originally designed to detect the ebpfkit rootkit. Falco (CNCF/Sysdig) A Host Intrusion Detection System (HIDS) that uses eBPF to monitor system calls for malicious activities. Recent versions can monitor bpf() syscall invocations to detect privilege escalation attempts using eBPF​ (sysdig.com). Open-source CNCF project. Often used in container/cloud environments with customizable rules. bpftool (Linux native tool) A built-in BPF debugging/management tool that lists loaded eBPF programs, maps, and links. Manual inspection using bpftool prog, bpftool map, etc., can help detect suspicious BPF objects and attachment points​ (redcanary.com). Available in Linux 4.x and above. Useful for manual inspections or lightweight scripting. Volatility eBPF Plugin A plugin for the memory forensic tool Volatility, allowing extraction and analysis of eBPF programs from memory dumps by searching the prog_idr structure​ (scitepress.org). Includes a classifier to identify potentially malicious programs. Research-grade tool (released in 2024). Most effective for hypervisor/offline memory dump analysis, as active rootkits can tamper with live systems. These tools vary in strengths and use cases.\nFor example, Tracee and Falco are strong in real-time detection, catching the exact moment an eBPF program is loaded or detecting suspicious system call patterns​ (scitepress.org)​ (sysdig.com).\nIn contrast, forensic tools like the Volatility plugin are valuable for post-compromise investigations, enabling detection of stealthy backdoors by analyzing hypervisor-level memory dumps​ (scitepress.org).\nSummary:\nCombining these tools according to the situation allows building a multi-layered eBPF threat detection strategy.\nLatest Detection Methodologies (2023–2025) and Research Trends Recent academic papers, security reports, and technical blogs have introduced various approaches and improvements for detecting eBPF-based backdoors.\nKey methodologies include:\n1. Real-Time Load Monitoring The most effective detection occurs at the moment an eBPF program is loaded into the kernel​ (redcanary.com).\nAccording to Red Canary, if you miss the loading event, detecting eBPF malware becomes extremely difficult.\nThus, EDR (Endpoint Detection and Response) solutions or custom monitoring tools must watch for bpf() syscalls, kprobe registrations, and similar events in real-time​ (redcanary.com).\nAqua Security incorporated bpf_attach event monitoring into Tracee, enabling automatic detection the moment a malicious eBPF program hooks into a kprobe or uretprobe​ (scitepress.org)​ (aquasec.com).\nIn 2023, Aqua detected the Pamspy malware, which hijacked PAM authentication using an eBPF uretprobe.\nBy capturing the loading event of the trace_pam_get_a eBPF program, they identified plaintext credential theft attempts​ (aquasec.com).\nSummary:\nKernel event hook monitoring is becoming a crucial trend in modern EDRs and open-source tools.\n2. Kernel Integrity Checking and Hardening Research efforts also focus on embedding security controls inside the kernel to block or detect eBPF backdoors proactively.\nRecommendations include:\nEnabling CONFIG_BPF_UNPRIV_DEFAULT_OFF to prevent unprivileged users from using eBPF​ (sysdig.com). Restricting SYS_bpf syscall usage to root users only. Disabling unnecessary options like CONFIG_BPF_KPROBE_OVERRIDE and reducing the attack surface by removing kprobe features during kernel compilation​ (redcanary.com). These approaches are preventive, aiming to reduce the risk before an attack happens.\n3. Hypervisor-Based Auditing Host-based detection tools can be bypassed by rootkits with kernel-level privileges​ (blog.thalium.re).\nTo address this, 2023–2024 research explored auditing eBPF activities from the hypervisor layer.\nExamples:\nThe HyperBee framework proposed inspecting eBPF programs loaded in guest OSs before execution​ (conferences.sigcomm.org). Another 2024 study showed snapshotting guest memory with lightweight hypervisors and using Volatility plugins to extract and classify suspicious eBPF helper functions​ (scitepress.org). Hypervisor-based techniques offer a promising path to detect stealthy rootkits without relying on compromised guest OSs.\n4. Post-Incident Inspection and Hunting If real-time detection fails, manual threat hunting becomes necessary.\nRecommendations from recent reports include:\nChecking for unexpected kprobes:\nInspect /sys/kernel/debug/kprobes/list for unusual hooks on unfamiliar functions​ (redcanary.com).\nListing loaded eBPF programs:\nUse bpftool prog to enumerate in-memory eBPF programs. Pay special attention to suspicious types like kprobe​ (redcanary.com).\nChecking BPF-linked perf events:\nbpftool perf can reveal which PIDs have attached probes.\nInspecting XDP and TC hooks:\nVerify if unexpected XDP programs (ip link show) or TC filters (tc filter show) are attached.\nMonitoring the BPF filesystem (bpffs):\nLook into /sys/fs/bpf/ for pinned objects that attackers may use for persistence​ (redcanary.com).\nChecking system logs:\nReview dmesg for BPF-related warnings, such as unauthorized bpf() usage or dangerous helper functions like bpf_override_return.\nSummary:\nModern threat hunting involves multi-angle system inspection, collecting any suspicious BPF-related evidence for deep analysis.\nReal-World Case Studies: Detecting and Responding to eBPF Backdoors One representative case that highlights the importance of eBPF detection is the BPFDoor backdoor.\nBPFDoor is a Linux backdoor discovered in the late 2010s, which utilized classic BPF (cBPF) filters to detect specific magic packets and open reverse shells for attackers​ (trendmicro.com).\nBecause it bypassed firewall rules and hid network ports from scans, it was dubbed a “doorless backdoor.”\nIn 2022, BPFDoor was publicly exposed, and by 2023, APT attackers had enhanced it, making BPF filters even more complex​ (trendmicro.com).\nSecurity vendors used both network-level and host-level indicators to detect BPFDoor:\nTrend Micro updated their products to detect BPFDoor’s BPF filter patterns​ (trendmicro.com). They investigated setsockopt calls inserting BPF filters and tracked suspicious raw socket processes. Trend Micro also noted that newer variants increased BPF filter complexity sixfold, indicating ongoing evolution​ (trendmicro.com). Takeaway:\nBPFDoor proved that BPF-based backdoors are detectable, but attackers are constantly adapting.\nAnother notable case is the detection of the Pamspy malware:\nPamspy exploited an eBPF uretprobe to intercept results from authentication functions inside libpam.so. Aqua Security researchers detected it using their open-source tool Tracee. The Tracee logs captured detailed information such as the hooked function name (pam_get_authtok) and memory offsets,\nallowing the detection of credential theft attempts without needing hidden processes​ (aquasec.com). Summary:\nModern breaches increasingly involve eBPF-based tactics, and community sharing of tools and case studies is advancing defensive strategies.\nResponse Strategies and Practical Recommendations To counter eBPF-based backdoors, a multilayered detection and prevention strategy is essential.\nHere are actionable recommendations for practical environments:\n1. Privilege Management and Hardening Disable eBPF entirely via kernel compile options or sysctl settings if not needed​ (sysdig.com). Restrict CAP_BPF capabilities and enforce CONFIG_BPF_UNPRIV_DEFAULT_OFF. Set CONFIG_BPF_JIT_ALWAYS_ON to minimize eBPF JIT exploitation risks. Disable unused kprobe/tracepoint features to reduce attack surface​ (redcanary.com). 2. Deploy Real-Time Monitoring Tools Deploy open-source HIDS/EDR tools that can monitor eBPF-related events. Falco can track suspicious bpf() or perf_event_open system calls with rule-based alerts​ (sysdig.com). Tracee can log kernel hook events in real time​ (scitepress.org). Consider containerizing these tools for lightweight deployment and always-on detection. 3. Conduct Regular Integrity Checks Schedule regular scans using bpftool to dump the list of loaded eBPF programs. Compare (diff) with previous outputs to identify new or suspicious entries. Focus especially on newly appeared kprobe, tracepoint, or unknown eBPF programs​ (redcanary.com). Regularly inspect /sys/fs/bpf/ and /sys/kernel/debug/kprobes/list for unusual activity​ (redcanary.com). 4. Prepare Forensic Capabilities Establish memory forensic procedures for critical servers. Prepare hypervisor-based snapshots or remote memory dump capabilities. Use tools like Volatility plugins to extract eBPF-related structures post-incident​ (scitepress.org). Memory forensics acts as a last line of defense against stealthy eBPF backdoors. 5. Continuously Update and Share Intelligence Stay updated on the latest security blogs, conferences, and GitHub repositories. Actively incorporate new IOCs (Indicators of Compromise) and detection rules. Quickly analyze and reflect new backdoor variants or malware samples (e.g., updated BPFDoor variants) into internal security measures. Summary:\neBPF backdoor detection demands a proactive, multilayered defense combining real-time monitoring, post-incident validation, preventive hardening, and continuous intelligence updates.\nSecurity professionals must leverage eBPF itself to watch the kernel from within, turning attackers’ tools into defenders’ shields.\n","wordCount":"2799","inLanguage":"en","datePublished":"2025-04-28T00:00:00Z","dateModified":"2025-04-28T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://windshock.github.io/en/post/2025-04-29-ebpf-backdoor-detection-framework/"},"publisher":{"@type":"Organization","name":"Code Before Breach","logo":{"@type":"ImageObject","url":"https://windshock.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://windshock.github.io/en/ accesskey=h title="Code Before Breach (Alt + H)"><img src=https://windshock.github.io/images/logo-terminal-animated.svg alt aria-label=logo class="h-7 w-auto" height=28>Code Before Breach</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://windshock.github.io/ko/ title=한국어 aria-label=한국어>Ko</a></li></ul></div></div><ul id=menu><li><a href=https://windshock.github.io/en/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://windshock.github.io/en/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://windshock.github.io/en/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://windshock.github.io/en/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://windshock.github.io/en/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://windshock.github.io/en/>Home</a>&nbsp;»&nbsp;<a href=https://windshock.github.io/en/post/>Posts</a></div><h1 class="post-title entry-hint-parent">Detection Frameworks and Latest Methodologies for eBPF-Based Backdoors</h1><div class=post-meta><span title='2025-04-28 00:00:00 +0000 UTC'>April 28, 2025</span>&nbsp;·&nbsp;14 min&nbsp;·&nbsp;2799 words&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://windshock.github.io/ko/post/2025-04-29-ebpf-backdoor-detection-framework/>Ko</a></li></ul></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#overview-the-rise-of-ebpf-backdoors-and-detection-challenges aria-label="Overview: The Rise of eBPF Backdoors and Detection Challenges">Overview: The Rise of eBPF Backdoors and Detection Challenges</a></li><li><a href=#detection-challenges-of-ebpf-backdoors aria-label="Detection Challenges of eBPF Backdoors">Detection Challenges of eBPF Backdoors</a></li><li><a href=#why-linux-anti-virus-cannot-cover-ebpf-backdoors aria-label="Why Linux Anti-Virus Cannot Cover eBPF Backdoors">Why Linux Anti-Virus Cannot Cover eBPF Backdoors</a><ul><li><a href=#key-reasons aria-label="Key Reasons">Key Reasons</a></li><li><a href=#practical-summary aria-label="Practical Summary">Practical Summary</a></li></ul></li><li><a href=#tracee-vs-lkrg-their-complementary-roles aria-label="Tracee vs LKRG: Their Complementary Roles">Tracee vs LKRG: Their Complementary Roles</a><ul><li><a href=#summary aria-label=Summary>Summary</a></li></ul></li><li><a href=#simple-script-for-detecting-bpfdoor-like-behavior aria-label="Simple Script for Detecting BPFDoor-like Behavior: bpfdoor_detector.sh">Simple Script for Detecting BPFDoor-like Behavior: bpfdoor_detector.sh</a><ul><li><a href=#script-features aria-label="Script Features">Script Features</a></li><li><a href=#usage aria-label=Usage>Usage</a></li><li><a href=#full-script-code aria-label="Full Script Code">Full Script Code</a></li><li><a href=#cautions aria-label=Cautions>Cautions</a></li></ul></li><li><a href=#checking-for-ebpf-backdoors-in-openstack-environments aria-label="Checking for eBPF Backdoors in OpenStack Environments">Checking for eBPF Backdoors in OpenStack Environments</a><ul><li><a href=#inspection-script-using-bpftool aria-label="Inspection Script Using bpftool">Inspection Script Using bpftool</a></li><li><a href=#script-explanation aria-label="Script Explanation">Script Explanation</a></li></ul></li><li><a href=#dealing-with-ebpf-backdoors-in-vsphere--vmware-nsx-environments aria-label="Dealing with eBPF Backdoors in vSphere + VMware NSX Environments">Dealing with eBPF Backdoors in vSphere + VMware NSX Environments</a><ul><li><a href=#possible-detection-strategies aria-label="Possible Detection Strategies">Possible Detection Strategies</a></li><li><a href=#cautions-1 aria-label=Cautions>Cautions</a></li></ul></li><li><a href=#publicly-available-ebpf-backdoor-detection-frameworks-and-tools aria-label="Publicly Available eBPF Backdoor Detection Frameworks and Tools">Publicly Available eBPF Backdoor Detection Frameworks and Tools</a></li><li><a href=#latest-detection-methodologies-20232025-and-research-trends aria-label="Latest Detection Methodologies (2023–2025) and Research Trends">Latest Detection Methodologies (2023–2025) and Research Trends</a><ul><li><a href=#1-real-time-load-monitoring aria-label="1. Real-Time Load Monitoring">1. Real-Time Load Monitoring</a></li><li><a href=#2-kernel-integrity-checking-and-hardening aria-label="2. Kernel Integrity Checking and Hardening">2. Kernel Integrity Checking and Hardening</a></li><li><a href=#3-hypervisor-based-auditing aria-label="3. Hypervisor-Based Auditing">3. Hypervisor-Based Auditing</a></li><li><a href=#4-post-incident-inspection-and-hunting aria-label="4. Post-Incident Inspection and Hunting">4. Post-Incident Inspection and Hunting</a></li></ul></li><li><a href=#real-world-case-studies-detecting-and-responding-to-ebpf-backdoors aria-label="Real-World Case Studies: Detecting and Responding to eBPF Backdoors">Real-World Case Studies: Detecting and Responding to eBPF Backdoors</a></li><li><a href=#response-strategies-and-practical-recommendations aria-label="Response Strategies and Practical Recommendations">Response Strategies and Practical Recommendations</a><ul><li><a href=#1-privilege-management-and-hardening aria-label="1. Privilege Management and Hardening">1. Privilege Management and Hardening</a></li><li><a href=#2-deploy-real-time-monitoring-tools aria-label="2. Deploy Real-Time Monitoring Tools">2. Deploy Real-Time Monitoring Tools</a></li><li><a href=#3-conduct-regular-integrity-checks aria-label="3. Conduct Regular Integrity Checks">3. Conduct Regular Integrity Checks</a></li><li><a href=#4-prepare-forensic-capabilities aria-label="4. Prepare Forensic Capabilities">4. Prepare Forensic Capabilities</a></li><li><a href=#5-continuously-update-and-share-intelligence aria-label="5. Continuously Update and Share Intelligence">5. Continuously Update and Share Intelligence</a></li></ul></li></ul></div></details></div><div class=post-content><p><img alt="ebpf hook overview" loading=lazy src=https://ebpf.io/static/99c69bbff092c35b9c83f00a80fed240/fb370/hook-overview.webp></p><h2 id=overview-the-rise-of-ebpf-backdoors-and-detection-challenges><strong>Overview: The Rise of eBPF Backdoors and Detection Challenges</strong><a hidden class=anchor aria-hidden=true href=#overview-the-rise-of-ebpf-backdoors-and-detection-challenges>#</a></h2><p>eBPF (extended BPF) is a powerful technology that allows dynamic injection of programs into the Linux kernel, originally intended for legitimate use cases such as <strong>performance monitoring and security enforcement</strong>​ (<a href="https://sysdig.com/blog/ebpf-offensive-capabilities/#:~:text=eBPF%20has%20gained%20a%20lot,specified%29%20kernel%20events%20occur">sysdig.com</a>)​ (<a href="https://sysdig.com/blog/ebpf-offensive-capabilities/#:~:text=In%20fact%2C%20in%20the%20many,and%20also%20enforce%20security%20policies">sysdig.com</a>). However, in recent years, attackers have increasingly <strong>abused eBPF to develop backdoors and rootkits</strong>, making eBPF a <em>double-edged sword</em> in the security landscape​ (<a href="https://www.aquasec.com/blog/detecting-ebpf-malware-with-tracee/#:~:text=protect%20organizations,malicious%20usage%20of%20the%20eBPF">aquasec.com</a>).<br>Since 2023, several rootkits (<code>ebpfkit</code>, <code>TripleCross</code>) and malware (<code>Pamspy</code>) utilizing eBPF have emerged, enabling <strong>malicious activities</strong> such as credential theft and firewall evasion​ (<a href="https://www.aquasec.com/blog/detecting-ebpf-malware-with-tracee/#:~:text=protect%20organizations,malicious%20usage%20of%20the%20eBPF">aquasec.com</a>).<br>Because eBPF-based backdoors operate at the kernel level, they are <strong>extremely difficult to detect</strong> and are often missed by traditional security tools​ (<a href="https://www.trendmicro.com/en_us/research/23/g/detecting-bpfdoor-backdoor-variants-abusing-bpf-filters.html#:~:text=difficult%20to%20detect%20due%20to,protection%20solutions%20in%20Linux%20and">trendmicro.com</a>)​ (<a href="https://redcanary.com/blog/threat-detection/ebpf-malware/#:~:text=Detection">redcanary.com</a>).<br>In this article, we comprehensively summarize open detection frameworks, tools, the latest research trends, challenges, strategies, case studies, and practical utilities for dealing with eBPF-based backdoors.</p><h2 id=detection-challenges-of-ebpf-backdoors><strong>Detection Challenges of eBPF Backdoors</strong><a hidden class=anchor aria-hidden=true href=#detection-challenges-of-ebpf-backdoors>#</a></h2><p><strong>eBPF backdoors are extremely difficult to detect using traditional rootkit detection methods.</strong><br>Unlike conventional kernel modules, eBPF programs do not appear as separate modules; instead, they execute inside the kernel’s BPF virtual machine, making them <strong>inherently stealthy</strong>.<br>For example, the <code>BPFDoor</code> backdoor used in APT attacks inserted packet filters into the kernel to <strong>bypass firewall rules</strong> while masquerading as if no network ports were open​ (<a href="https://www.trendmicro.com/en_us/research/23/g/detecting-bpfdoor-backdoor-variants-abusing-bpf-filters.html#:~:text=difficult%20to%20detect%20due%20to,protection%20solutions%20in%20Linux%20and">trendmicro.com</a>).<br>Once an eBPF rootkit is installed, it can even <strong>manipulate the outputs of system diagnostic tools</strong> to hide its presence​ (<a href="https://redcanary.com/blog/threat-detection/ebpf-malware/#:~:text=Detection">redcanary.com</a>).<br>According to Red Canary’s analysis, once loaded, eBPF malware can stealthily alter results from tools like <code>bpftool</code> and <code>debugfs</code>, making post-compromise detection extremely difficult​ (<a href="https://redcanary.com/blog/threat-detection/ebpf-malware/#:~:text=Detection">redcanary.com</a>).<br>Thus, if detection <strong>fails at the loading stage</strong>, identifying the backdoor afterward becomes extremely challenging—this is the <strong>core difficulty</strong> in detecting eBPF backdoors​ (<a href="https://redcanary.com/blog/threat-detection/ebpf-malware/#:~:text=Detection">redcanary.com</a>).</p><p>To overcome these challenges, a strategy combining <strong>real-time monitoring</strong> and <strong>post-incident forensic techniques</strong> is essential.<br>For example, <strong>kernel-level monitoring tools</strong> that intercept eBPF program loading events can detect malicious eBPF activity <strong>at its inception</strong>​ (<a href="https://www.scitepress.org/Papers/2024/124708/124708.pdf#:~:text=out%3A%20Tracee%20,event%20oc%02curs%20whenever%20an%20eBPF">scitepress.org</a>).<br>Conversely, if a rootkit is already active, <strong>hypervisor-based</strong> or <strong>memory forensic approaches</strong> must be employed to examine kernel memory externally​ (<a href="https://www.scitepress.org/Papers/2024/124708/124708.pdf#:~:text=While%20these%20two%20tools%20provide,is%20believed%20to%20be%20secure">scitepress.org</a>).<br>Below, we will explore these <strong>real-time detection frameworks</strong> and <strong>research-driven methodologies</strong>, analyzing their characteristics and limitations in detail.</p><h2 id=why-linux-anti-virus-cannot-cover-ebpf-backdoors><strong>Why Linux Anti-Virus Cannot Cover eBPF Backdoors</strong><a hidden class=anchor aria-hidden=true href=#why-linux-anti-virus-cannot-cover-ebpf-backdoors>#</a></h2><p><strong>Conclusion:</strong><br>General-purpose Linux anti-virus solutions cannot detect or block eBPF-based backdoors.</p><h3 id=key-reasons><strong>Key Reasons</strong><a hidden class=anchor aria-hidden=true href=#key-reasons>#</a></h3><ul><li><p><strong>eBPF backdoors are not file-based:</strong><br>Traditional Linux anti-virus tools are optimized for scanning malicious files in the file system.<br>However, eBPF programs are loaded into the kernel’s BPF subsystem and are executed upon specific events, meaning they do <strong>not exist directly</strong> in the file system.</p></li><li><p><strong>Inability to monitor internal kernel activities:</strong><br>Conventional Linux AV solutions primarily monitor user-space processes and disk I/O activities.<br>eBPF programs operate within kernel space, far beyond the reach of traditional AV monitoring.</p></li><li><p><strong>Potential for information manipulation:</strong><br>eBPF rootkits can tamper with system calls, process lists, and file lists.<br>Therefore, the data seen by the AV scanner itself may already be <strong>forged</strong>.</p></li><li><p><strong>Inability to detect BPF-level hooks:</strong><br>Traditional anti-virus scanners cannot capture kernel-level activities like system call table hooking, kprobe/uprobes attachment, or eBPF event interception.</p></li></ul><h3 id=practical-summary><strong>Practical Summary</strong><a hidden class=anchor aria-hidden=true href=#practical-summary>#</a></h3><ul><li><strong>File-based malware</strong> (e.g., web shells, trojans): <strong>Detectable</strong></li><li><strong>Kernel-space eBPF backdoors</strong>: <strong>Not detectable</strong></li><li><strong>Kernel module-based rootkits</strong>: <strong>Not detectable</strong></li></ul><blockquote><p>&ldquo;Linux antivirus solutions fundamentally cannot detect eBPF backdoors.<br>Without kernel-level integrity protection, no output can be trusted.&rdquo;</p></blockquote><p><strong>Therefore, the use of kernel integrity protection modules like LKRG (Linux Kernel Runtime Guard) is strongly recommended.</strong></p><h2 id=tracee-vs-lkrg-their-complementary-roles><strong>Tracee vs LKRG: Their Complementary Roles</strong><a hidden class=anchor aria-hidden=true href=#tracee-vs-lkrg-their-complementary-roles>#</a></h2><p>When addressing eBPF backdoors and kernel rootkits, Tracee and LKRG complement each other at different layers.</p><table><thead><tr><th style=text-align:left>Aspect</th><th style=text-align:left>Tracee</th><th style=text-align:left>LKRG</th></tr></thead><tbody><tr><td style=text-align:left><strong>What is monitored?</strong></td><td style=text-align:left>Kernel events (e.g., bpf calls, execve, open)</td><td style=text-align:left>Kernel object integrity (e.g., syscall table, credentials)</td></tr><tr><td style=text-align:left><strong>When is monitoring performed?</strong></td><td style=text-align:left>Detection upon the occurrence of <strong>attack events</strong></td><td style=text-align:left>Detection upon <strong>attempts to tamper</strong> with kernel structures</td></tr><tr><td style=text-align:left><strong>Detection focus</strong></td><td style=text-align:left>System call level</td><td style=text-align:left>Kernel memory structure level</td></tr><tr><td style=text-align:left><strong>Primary goal</strong></td><td style=text-align:left>Threat hunting (detect anomalies)</td><td style=text-align:left>Integrity enforcement and protection</td></tr><tr><td style=text-align:left><strong>Operation method</strong></td><td style=text-align:left>Passive event logging and alerting</td><td style=text-align:left>Active prevention or alerting on integrity violations</td></tr><tr><td style=text-align:left><strong>Nature</strong></td><td style=text-align:left>Incident response-oriented</td><td style=text-align:left>Incident prevention-oriented</td></tr></tbody></table><h3 id=summary><strong>Summary</strong><a hidden class=anchor aria-hidden=true href=#summary>#</a></h3><ul><li><strong>Tracee</strong> acts as a <strong>security camera</strong>, recording anomalous activities after they happen.</li><li><strong>LKRG</strong> serves as <strong>security bars</strong>, actively monitoring kernel structures and preventing tampering.</li></ul><blockquote><p>&ldquo;Using only Tracee records incidents but cannot block them.<br>Using only LKRG blocks tampering but leaves no forensic trail.<br><strong>Using both together provides the strongest protection, combining detection and prevention.</strong>&rdquo;</p></blockquote><h2 id=simple-script-for-detecting-bpfdoor-like-behavior><strong>Simple Script for Detecting BPFDoor-like Behavior: <code>bpfdoor_detector.sh</code></strong><a hidden class=anchor aria-hidden=true href=#simple-script-for-detecting-bpfdoor-like-behavior>#</a></h2><p>This is a lightweight script designed to detect processes exhibiting behaviors similar to the <strong>BPFDoor</strong> eBPF backdoor.</p><h3 id=script-features><strong>Script Features</strong><a hidden class=anchor aria-hidden=true href=#script-features>#</a></h3><ul><li>Detects processes running with <strong>deleted executables</strong> (<code>(deleted)</code> state).</li><li>Filters processes that are using <strong>BPF sockets</strong>.</li><li><strong>Excludes</strong> legitimate programs that use BPF, such as <code>tcpdump</code>, <code>wireshark</code>, and <code>dhclient</code>.</li><li>Displays <strong>basic network connection information</strong> for suspicious processes.</li></ul><h3 id=usage><strong>Usage</strong><a hidden class=anchor aria-hidden=true href=#usage>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ./bpfdoor_detector.sh
</span></span></code></pre></div><ul><li>Must be run with <strong>root privileges</strong>.</li><li>Required commands: <code>ps</code>, <code>grep</code>, <code>readlink</code>, <code>ss</code></li></ul><h3 id=full-script-code><strong>Full Script Code</strong><a hidden class=anchor aria-hidden=true href=#full-script-code>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e># BPFDoor-like Suspicious Process Detector</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Check for root permission</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>id -u<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> -ne <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;[!] This script must be run as root.&#34;</span>
</span></span><span style=display:flex><span>  exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Check required commands</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> cmd in ps grep readlink ss; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ! command -v $cmd &amp;&gt;/dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[!] </span>$cmd<span style=color:#e6db74> command is required. Please install it first.&#34;</span>
</span></span><span style=display:flex><span>    exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;[*] Starting focused BPFDoor-like process detection...&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>found<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Iterate over all PIDs</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> pid in <span style=color:#66d9ef>$(</span>ls /proc/ | grep -E <span style=color:#e6db74>&#39;^[0-9]+$&#39;</span><span style=color:#66d9ef>)</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[</span> -d <span style=color:#e6db74>&#34;/proc/</span>$pid<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span> <span style=color:#f92672>||</span> <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  exe_path<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>readlink /proc/$pid/exe 2&gt;/dev/null<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> $exe_path <span style=color:#f92672>==</span> *<span style=color:#e6db74>&#34;(deleted)&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -r /proc/$pid/net/packet <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>[</span> -s /proc/$pid/net/packet <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>      cmdline<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>ps -p $pid -o cmd<span style=color:#f92672>=</span> 2&gt;/dev/null<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> ! $cmdline <span style=color:#f92672>=</span>~ <span style=color:#e6db74>&#34;tcpdump|wireshark|dhclient&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;[!] Suspicious process detected:&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;    - PID: </span>$pid<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;    - Command: </span>$cmdline<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;    - Deleted executable: </span>$exe_path<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;    - BPF socket is active&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        ss -p -n 2&gt;/dev/null | grep <span style=color:#e6db74>&#34;pid=</span>$pid<span style=color:#e6db74>,&#34;</span> | awk <span style=color:#e6db74>&#39;{print &#34;    - Network: &#34; $0}&#39;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        found<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> $found -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;[*] No suspicious processes found.&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;[*] Detection completed.&#34;</span>
</span></span></code></pre></div><h3 id=cautions><strong>Cautions</strong><a hidden class=anchor aria-hidden=true href=#cautions>#</a></h3><ul><li>This script provides <strong>only lightweight hints</strong> at the process level.</li><li><strong>Advanced eBPF rootkits can tamper with <code>/proc</code></strong>, so relying solely on this script is <strong>not sufficient</strong>.</li><li>It is <strong>strongly recommended to use this script in combination with kernel integrity protection modules</strong> like LKRG.</li></ul><blockquote><p>Without kernel integrity protection like LKRG, even detection results may be forged.</p></blockquote><h2 id=checking-for-ebpf-backdoors-in-openstack-environments><strong>Checking for eBPF Backdoors in OpenStack Environments</strong><a hidden class=anchor aria-hidden=true href=#checking-for-ebpf-backdoors-in-openstack-environments>#</a></h2><p>In OpenStack environments, you can directly inspect eBPF activities from the host OS (KVM Hypervisor).</p><h3 id=inspection-script-using-bpftool><strong>Inspection Script Using bpftool</strong><a hidden class=anchor aria-hidden=true href=#inspection-script-using-bpftool>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e># List all BPF programs</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;[*] Listing currently loaded BPF programs...&#34;</span>
</span></span><span style=display:flex><span>bpftool prog show
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># List all BPF maps</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;[*] Listing currently loaded BPF maps...&#34;</span>
</span></span><span style=display:flex><span>bpftool map show
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Optional: Check for unexpected XDP attachments</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;[*] Checking for XDP programs attached to network interfaces...&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> iface in <span style=color:#66d9ef>$(</span>ls /sys/class/net/<span style=color:#66d9ef>)</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  ip link show dev <span style=color:#e6db74>&#34;</span>$iface<span style=color:#e6db74>&#34;</span> | grep -q <span style=color:#e6db74>&#34;xdp&#34;</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;[!] XDP attached: </span>$iface<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Optional: Check for TC filters</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;[*] Checking for TC filters...&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> iface in <span style=color:#66d9ef>$(</span>ls /sys/class/net/<span style=color:#66d9ef>)</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  tc filter show dev <span style=color:#e6db74>&#34;</span>$iface<span style=color:#e6db74>&#34;</span> 2&gt;/dev/null | grep -i <span style=color:#e6db74>&#34;bpf&#34;</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;[!] BPF TC filter detected on: </span>$iface<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;[*] BPF scan completed.&#34;</span>
</span></span></code></pre></div><h3 id=script-explanation><strong>Script Explanation</strong><a hidden class=anchor aria-hidden=true href=#script-explanation>#</a></h3><ul><li><strong><code>bpftool prog show</code></strong>: Lists all currently loaded eBPF programs in the kernel. Essential for spotting potentially malicious BPF programs.</li><li><strong><code>bpftool map show</code></strong>: Lists all BPF maps. Malicious actors may exploit maps for C2 command control or session management.</li><li><strong>Checking XDP attachments</strong>:<ul><li>Use <code>ip link show</code> to check if any XDP programs are attached to network interfaces.</li><li>XDP (eXpress Data Path) allows direct packet interception at the NIC (Layer 2) level and may be exploited by backdoors like BPFDoor to manipulate traffic stealthily.</li></ul></li><li><strong>Checking TC (Traffic Control) filters</strong>:<ul><li>Use <code>tc filter show</code> to check if BPF-based traffic filters are applied to network interfaces.</li><li>TC filters can be used to selectively manipulate network traffic.</li></ul></li></ul><blockquote><p><strong>Summary</strong>:<br>By inspecting BPF programs, maps, XDP attachments, and TC filters, you can detect traces of eBPF backdoors early from the OpenStack host level.</p></blockquote><h2 id=dealing-with-ebpf-backdoors-in-vsphere--vmware-nsx-environments><strong>Dealing with eBPF Backdoors in vSphere + VMware NSX Environments</strong><a hidden class=anchor aria-hidden=true href=#dealing-with-ebpf-backdoors-in-vsphere--vmware-nsx-environments>#</a></h2><p>In vSphere (ESXi) environments, direct inspection inside guest OSs is difficult,<br>but NSX allows detection of abnormal behaviors at the <strong>network level</strong>.</p><h3 id=possible-detection-strategies><strong>Possible Detection Strategies</strong><a hidden class=anchor aria-hidden=true href=#possible-detection-strategies>#</a></h3><table><thead><tr><th style=text-align:left>Method</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>Using Distributed Firewall (DFW) Rules</strong></td><td style=text-align:left>Detect or block unexpected outbound port usage or C2 server connection attempts.</td></tr><tr><td style=text-align:left><strong>Activating NSX IDS/IPS Features</strong></td><td style=text-align:left>Detect communication patterns similar to BPFDoor (e.g., abnormal UDP, ICMP tunneling).</td></tr><tr><td style=text-align:left><strong>Using Flow Analytics</strong></td><td style=text-align:left>Analyze East-West traffic between VMs to detect abnormal communication flows.</td></tr><tr><td style=text-align:left><strong>Leveraging NSX Threat Intelligence</strong></td><td style=text-align:left>If NSX ATP (Advanced Threat Protection) modules are enabled, detect known IOCs (Indicators of Compromise).</td></tr></tbody></table><h3 id=cautions-1><strong>Cautions</strong><a hidden class=anchor aria-hidden=true href=#cautions-1>#</a></h3><ul><li>NSX <strong>cannot detect internal kernel tampering</strong>. (Detection is purely from a network perspective.)</li><li><strong>Separate monitoring inside guest OSs</strong> is still necessary. (e.g., using Tracee, EDR, etc.)</li></ul><blockquote><p>&ldquo;<strong>In vSphere environments, the most effective approach is a dual-layered structure:<br>use NSX for network-level anomaly detection, and deploy separate runtime security tools inside guest OSs for kernel monitoring.</strong>&rdquo;</p></blockquote><h2 id=publicly-available-ebpf-backdoor-detection-frameworks-and-tools><strong>Publicly Available eBPF Backdoor Detection Frameworks and Tools</strong><a hidden class=anchor aria-hidden=true href=#publicly-available-ebpf-backdoor-detection-frameworks-and-tools>#</a></h2><p>Several <strong>open-source tools and frameworks</strong> have recently been developed to detect malicious eBPF activities.<br>Here are key tools and their characteristics:</p><table><thead><tr><th style=text-align:left>Tool/Framework</th><th style=text-align:left>Approach and Features</th><th style=text-align:left>Remarks</th></tr></thead><tbody><tr><td style=text-align:left><strong>Tracee (Aqua Security)</strong></td><td style=text-align:left>An <strong>eBPF-based real-time monitoring tool</strong> that traces kernel events to detect malicious behaviors. Especially captures <code>bpf_attach</code> events at the moment an eBPF program attaches to a kprobe/tracepoint, recording ID, name, type, and used helper functions​ (<a href="https://www.scitepress.org/Papers/2024/124708/124708.pdf#:~:text=out%3A%20Tracee%20,event%20oc%02curs%20whenever%20an%20eBPF">scitepress.org</a>)​ (<a href="https://www.aquasec.com/blog/detecting-ebpf-malware-with-tracee/#:~:text=Aqua%20Tracee%20%E2%80%93%20Out">aquasec.com</a>).</td><td style=text-align:left>Open-source (available on GitHub). Developed by Aqua Security for detecting eBPF rootkits and malware.</td></tr><tr><td style=text-align:left><strong>ebpfkit-monitor</strong></td><td style=text-align:left>A specialized tool developed by Datadog researchers (Fournier) that <strong>statically analyzes</strong> eBPF bytecode or <strong>monitors execution</strong> to detect malicious eBPF loading​ (<a href="https://www.scitepress.org/Papers/2024/124708/124708.pdf#:~:text=On%20the%20other%20hand%2C%20ebpfkit,Such%20rootkits%20can%20hide%20themselves">scitepress.org</a>).</td><td style=text-align:left>Open-source (available on GitHub). Originally designed to detect the <code>ebpfkit</code> rootkit.</td></tr><tr><td style=text-align:left><strong>Falco (CNCF/Sysdig)</strong></td><td style=text-align:left>A <strong>Host Intrusion Detection System (HIDS)</strong> that uses eBPF to monitor system calls for malicious activities. Recent versions can <strong>monitor <code>bpf()</code> syscall invocations</strong> to detect privilege escalation attempts using eBPF​ (<a href="https://sysdig.com/blog/ebpf-offensive-capabilities/#:~:text=The%20best%20way%20to%20deal,kernel%20and%20detect%20suspicious%20activities">sysdig.com</a>).</td><td style=text-align:left>Open-source CNCF project. Often used in container/cloud environments with customizable rules.</td></tr><tr><td style=text-align:left><strong>bpftool (Linux native tool)</strong></td><td style=text-align:left>A <strong>built-in BPF debugging/management tool</strong> that lists loaded eBPF programs, maps, and links. Manual inspection using <code>bpftool prog</code>, <code>bpftool map</code>, etc., can help detect suspicious BPF objects and attachment points​ (<a href="https://redcanary.com/blog/threat-detection/ebpf-malware/#:~:text=Use%20,programs">redcanary.com</a>).</td><td style=text-align:left>Available in Linux 4.x and above. Useful for manual inspections or lightweight scripting.</td></tr><tr><td style=text-align:left><strong>Volatility eBPF Plugin</strong></td><td style=text-align:left>A plugin for the memory forensic tool <strong>Volatility</strong>, allowing <strong>extraction and analysis of eBPF programs from memory dumps</strong> by searching the <code>prog_idr</code> structure​ (<a href="https://www.scitepress.org/Papers/2024/124708/124708.pdf#:~:text=the%20compiled%20eBPF%20programs,the%20called%20functions%20are%20identified">scitepress.org</a>). Includes a <strong>classifier</strong> to identify potentially malicious programs.</td><td style=text-align:left>Research-grade tool (released in 2024). Most effective for hypervisor/offline memory dump analysis, as active rootkits can tamper with live systems.</td></tr></tbody></table><hr><p>These tools vary in <strong>strengths and use cases</strong>.<br>For example, <strong>Tracee</strong> and <strong>Falco</strong> are strong in <strong>real-time detection</strong>, catching the exact moment an eBPF program is loaded or detecting suspicious system call patterns​ (<a href="https://www.scitepress.org/Papers/2024/124708/124708.pdf#:~:text=out%3A%20Tracee%20,event%20oc%02curs%20whenever%20an%20eBPF">scitepress.org</a>)​ (<a href="https://sysdig.com/blog/ebpf-offensive-capabilities/#:~:text=The%20best%20way%20to%20deal,kernel%20and%20detect%20suspicious%20activities">sysdig.com</a>).</p><p>In contrast, forensic tools like the <strong>Volatility plugin</strong> are valuable for <strong>post-compromise investigations</strong>, enabling detection of stealthy backdoors by analyzing hypervisor-level memory dumps​ (<a href="https://www.scitepress.org/Papers/2024/124708/124708.pdf#:~:text=While%20these%20two%20tools%20provide,is%20believed%20to%20be%20secure">scitepress.org</a>).</p><blockquote><p><strong>Summary</strong>:<br>Combining these tools according to the situation allows building a <strong>multi-layered eBPF threat detection strategy</strong>.</p></blockquote><h2 id=latest-detection-methodologies-20232025-and-research-trends><strong>Latest Detection Methodologies (2023–2025) and Research Trends</strong><a hidden class=anchor aria-hidden=true href=#latest-detection-methodologies-20232025-and-research-trends>#</a></h2><p>Recent <strong>academic papers, security reports, and technical blogs</strong> have introduced various approaches and improvements for detecting eBPF-based backdoors.<br>Key methodologies include:</p><h3 id=1-real-time-load-monitoring><strong>1. Real-Time Load Monitoring</strong><a hidden class=anchor aria-hidden=true href=#1-real-time-load-monitoring>#</a></h3><p>The most effective detection occurs <strong>at the moment an eBPF program is loaded into the kernel</strong>​ (<a href="https://redcanary.com/blog/threat-detection/ebpf-malware/#:~:text=If%20you%20suspect%20there%20may,based%20malware">redcanary.com</a>).</p><p>According to Red Canary, if you miss the loading event, detecting eBPF malware becomes <strong>extremely difficult</strong>.<br>Thus, EDR (Endpoint Detection and Response) solutions or custom monitoring tools must watch for <strong><code>bpf()</code> syscalls</strong>, <strong>kprobe registrations</strong>, and similar events in real-time​ (<a href="https://redcanary.com/blog/threat-detection/ebpf-malware/#:~:text=If%20you%20suspect%20there%20may,can%E2%80%99t%20trust%20the%20data%20you">redcanary.com</a>).</p><p>Aqua Security incorporated <code>bpf_attach</code> event monitoring into <strong>Tracee</strong>, enabling automatic detection the moment a malicious eBPF program hooks into a kprobe or uretprobe​ (<a href="https://www.scitepress.org/Papers/2024/124708/124708.pdf#:~:text=out%3A%20Tracee%20,event%20oc%02curs%20whenever%20an%20eBPF">scitepress.org</a>)​ (<a href="https://www.aquasec.com/blog/detecting-ebpf-malware-with-tracee/#:~:text=Aqua%20Tracee%20%E2%80%93%20Out">aquasec.com</a>).</p><p>In 2023, Aqua detected the <strong>Pamspy malware</strong>, which hijacked PAM authentication using an eBPF uretprobe.<br>By capturing the loading event of the <code>trace_pam_get_a</code> eBPF program, they identified <strong>plaintext credential theft attempts</strong>​ (<a href="https://www.aquasec.com/blog/detecting-ebpf-malware-with-tracee/#:~:text=Below%20you%20can%20see%20a,clear%20text%20username%20and%20password">aquasec.com</a>).</p><blockquote><p><strong>Summary</strong>:<br><strong>Kernel event hook monitoring</strong> is becoming a crucial trend in modern EDRs and open-source tools.</p></blockquote><hr><h3 id=2-kernel-integrity-checking-and-hardening><strong>2. Kernel Integrity Checking and Hardening</strong><a hidden class=anchor aria-hidden=true href=#2-kernel-integrity-checking-and-hardening>#</a></h3><p>Research efforts also focus on embedding <strong>security controls inside the kernel</strong> to block or detect eBPF backdoors proactively.</p><p>Recommendations include:</p><ul><li>Enabling <code>CONFIG_BPF_UNPRIV_DEFAULT_OFF</code> to prevent unprivileged users from using eBPF​ (<a href="https://sysdig.com/blog/ebpf-offensive-capabilities/#:~:text=The%20most%20effective%20way%20to,Kprobe%2C%20TC%2C%20and%20so%20on">sysdig.com</a>).</li><li>Restricting <code>SYS_bpf</code> syscall usage to root users only.</li><li>Disabling unnecessary options like <code>CONFIG_BPF_KPROBE_OVERRIDE</code> and reducing the attack surface by <strong>removing kprobe features</strong> during kernel compilation​ (<a href="https://redcanary.com/blog/threat-detection/ebpf-malware/#:~:text=,programmatically%20disable%20things%20like%20kprobes">redcanary.com</a>).</li></ul><blockquote><p>These approaches are <strong>preventive</strong>, aiming to reduce the risk before an attack happens.</p></blockquote><hr><h3 id=3-hypervisor-based-auditing><strong>3. Hypervisor-Based Auditing</strong><a hidden class=anchor aria-hidden=true href=#3-hypervisor-based-auditing>#</a></h3><p>Host-based detection tools can be <strong>bypassed by rootkits</strong> with kernel-level privileges​ (<a href="https://blog.thalium.re/posts/linux-kernel-rust-module-for-rootkit-detection/#:~:text=to%20place%20our%20EDR%20in,the%20kernel">blog.thalium.re</a>).</p><p>To address this, 2023–2024 research explored <strong>auditing eBPF activities from the hypervisor layer</strong>.</p><p>Examples:</p><ul><li>The <strong>HyperBee</strong> framework proposed inspecting eBPF programs loaded in guest OSs <strong>before execution</strong>​ (<a href="https://conferences.sigcomm.org/sigcomm/2023/files/workshop-ebpf/10-HyperBee.pdf#:~:text=Comprehensiveness,and%20their%20user%20space">conferences.sigcomm.org</a>).</li><li>Another 2024 study showed <strong>snapshotting guest memory</strong> with lightweight hypervisors and using Volatility plugins to extract and classify suspicious eBPF helper functions​ (<a href="https://www.scitepress.org/Papers/2024/124708/124708.pdf#:~:text=the%20compiled%20eBPF%20programs,the%20called%20functions%20are%20identified">scitepress.org</a>).</li></ul><blockquote><p>Hypervisor-based techniques offer a promising path to detect <strong>stealthy rootkits</strong> without relying on compromised guest OSs.</p></blockquote><hr><h3 id=4-post-incident-inspection-and-hunting><strong>4. Post-Incident Inspection and Hunting</strong><a hidden class=anchor aria-hidden=true href=#4-post-incident-inspection-and-hunting>#</a></h3><p>If real-time detection fails, <strong>manual threat hunting</strong> becomes necessary.<br>Recommendations from recent reports include:</p><ul><li><p><strong>Checking for unexpected kprobes</strong>:<br>Inspect <code>/sys/kernel/debug/kprobes/list</code> for unusual hooks on unfamiliar functions​ (<a href="https://redcanary.com/blog/threat-detection/ebpf-malware/#:~:text=Look%20for%20unexpected%20kprobes%20loaded%3A">redcanary.com</a>).</p></li><li><p><strong>Listing loaded eBPF programs</strong>:<br>Use <code>bpftool prog</code> to enumerate in-memory eBPF programs. Pay special attention to suspicious types like <code>kprobe</code>​ (<a href="https://redcanary.com/blog/threat-detection/ebpf-malware/#:~:text=Use%20,programs">redcanary.com</a>).</p></li><li><p><strong>Checking BPF-linked perf events</strong>:<br><code>bpftool perf</code> can reveal which PIDs have attached probes.</p></li><li><p><strong>Inspecting XDP and TC hooks</strong>:<br>Verify if unexpected XDP programs (<code>ip link show</code>) or TC filters (<code>tc filter show</code>) are attached.</p></li><li><p><strong>Monitoring the BPF filesystem (<code>bpffs</code>)</strong>:<br>Look into <code>/sys/fs/bpf/</code> for <strong>pinned objects</strong> that attackers may use for persistence​ (<a href="https://redcanary.com/blog/threat-detection/ebpf-malware/#:~:text=Check%20if%20there%20are%20any,BPF%20filesystem">redcanary.com</a>).</p></li><li><p><strong>Checking system logs</strong>:<br>Review <code>dmesg</code> for BPF-related warnings, such as unauthorized <code>bpf()</code> usage or dangerous helper functions like <code>bpf_override_return</code>.</p></li></ul><blockquote><p><strong>Summary</strong>:<br>Modern threat hunting involves <strong>multi-angle system inspection</strong>, collecting any suspicious BPF-related evidence for deep analysis.</p></blockquote><hr><h2 id=real-world-case-studies-detecting-and-responding-to-ebpf-backdoors><strong>Real-World Case Studies: Detecting and Responding to eBPF Backdoors</strong><a hidden class=anchor aria-hidden=true href=#real-world-case-studies-detecting-and-responding-to-ebpf-backdoors>#</a></h2><p>One representative case that highlights the importance of eBPF detection is the <strong>BPFDoor backdoor</strong>.</p><p><strong>BPFDoor</strong> is a Linux backdoor discovered in the late 2010s, which utilized <strong>classic BPF (cBPF) filters</strong> to detect specific <strong>magic packets</strong> and open reverse shells for attackers​ (<a href="https://www.trendmicro.com/en_us/research/23/g/detecting-bpfdoor-backdoor-variants-abusing-bpf-filters.html#:~:text=BPFDoor%20samples%20load%20classic%20BPF,uniquely%20stand%20for%20specific%20identifiers">trendmicro.com</a>).<br>Because it bypassed firewall rules and hid network ports from scans, it was dubbed a &ldquo;<strong>doorless backdoor</strong>.&rdquo;</p><p>In 2022, BPFDoor was publicly exposed, and by 2023, APT attackers had enhanced it, making BPF filters even more complex​ (<a href="https://www.trendmicro.com/en_us/research/23/g/detecting-bpfdoor-backdoor-variants-abusing-bpf-filters.html#:~:text=This%20entry%20shows%20how%20Red,of%20BPFDoor%20in%20infected%20systems">trendmicro.com</a>).</p><p><strong>Security vendors used both network-level and host-level indicators</strong> to detect BPFDoor:</p><ul><li><strong>Trend Micro</strong> updated their products to detect BPFDoor’s BPF filter patterns​ (<a href="https://www.trendmicro.com/en_us/research/23/g/detecting-bpfdoor-backdoor-variants-abusing-bpf-filters.html#:~:text=difficult%20to%20detect%20due%20to,protection%20solutions%20in%20Linux%20and">trendmicro.com</a>).</li><li>They investigated <strong>setsockopt calls inserting BPF filters</strong> and tracked suspicious <strong>raw socket processes</strong>.</li><li>Trend Micro also noted that newer variants increased BPF filter complexity sixfold, indicating ongoing evolution​ (<a href="https://www.trendmicro.com/en_us/research/23/g/detecting-bpfdoor-backdoor-variants-abusing-bpf-filters.html#:~:text=From%20a%20technical%20perspective%2C%20the,refer%20to%20the%20same%20technology">trendmicro.com</a>).</li></ul><blockquote><p><strong>Takeaway</strong>:<br>BPFDoor proved that <strong>BPF-based backdoors are detectable</strong>, but attackers are constantly adapting.</p></blockquote><hr><p>Another notable case is the detection of the <strong>Pamspy malware</strong>:</p><ul><li><strong>Pamspy</strong> exploited an eBPF <strong>uretprobe</strong> to intercept results from authentication functions inside <code>libpam.so</code>.</li><li>Aqua Security researchers detected it using their open-source tool <strong>Tracee</strong>.</li><li>The Tracee logs captured detailed information such as the <strong>hooked function name</strong> (<code>pam_get_authtok</code>) and <strong>memory offsets</strong>,<br>allowing the detection of <strong>credential theft attempts without needing hidden processes</strong>​ (<a href="https://www.aquasec.com/blog/detecting-ebpf-malware-with-tracee/#:~:text=Below%20you%20can%20see%20a,clear%20text%20username%20and%20password">aquasec.com</a>).</li></ul><blockquote><p><strong>Summary</strong>:<br><strong>Modern breaches increasingly involve eBPF-based tactics</strong>, and community sharing of tools and case studies is advancing defensive strategies.</p></blockquote><h2 id=response-strategies-and-practical-recommendations><strong>Response Strategies and Practical Recommendations</strong><a hidden class=anchor aria-hidden=true href=#response-strategies-and-practical-recommendations>#</a></h2><p>To counter eBPF-based backdoors, <strong>a multilayered detection and prevention strategy is essential</strong>.<br>Here are actionable recommendations for practical environments:</p><h3 id=1-privilege-management-and-hardening><strong>1. Privilege Management and Hardening</strong><a hidden class=anchor aria-hidden=true href=#1-privilege-management-and-hardening>#</a></h3><ul><li><strong>Disable eBPF</strong> entirely via kernel compile options or sysctl settings if not needed​ (<a href="https://sysdig.com/blog/ebpf-offensive-capabilities/#:~:text=The%20most%20effective%20way%20to,Kprobe%2C%20TC%2C%20and%20so%20on">sysdig.com</a>).</li><li>Restrict <code>CAP_BPF</code> capabilities and enforce <code>CONFIG_BPF_UNPRIV_DEFAULT_OFF</code>.</li><li>Set <code>CONFIG_BPF_JIT_ALWAYS_ON</code> to minimize eBPF JIT exploitation risks.</li><li>Disable unused kprobe/tracepoint features to reduce attack surface​ (<a href="https://redcanary.com/blog/threat-detection/ebpf-malware/#:~:text=,programmatically%20disable%20things%20like%20kprobes">redcanary.com</a>).</li></ul><hr><h3 id=2-deploy-real-time-monitoring-tools><strong>2. Deploy Real-Time Monitoring Tools</strong><a hidden class=anchor aria-hidden=true href=#2-deploy-real-time-monitoring-tools>#</a></h3><ul><li>Deploy <strong>open-source HIDS/EDR tools</strong> that can monitor eBPF-related events.</li><li><strong>Falco</strong> can track suspicious <code>bpf()</code> or <code>perf_event_open</code> system calls with rule-based alerts​ (<a href="https://sysdig.com/blog/ebpf-offensive-capabilities/#:~:text=The%20best%20way%20to%20deal,kernel%20and%20detect%20suspicious%20activities">sysdig.com</a>).</li><li><strong>Tracee</strong> can log kernel hook events in real time​ (<a href="https://www.scitepress.org/Papers/2024/124708/124708.pdf#:~:text=out%3A%20Tracee%20,event%20oc%02curs%20whenever%20an%20eBPF">scitepress.org</a>).</li><li>Consider containerizing these tools for lightweight deployment and <strong>always-on detection</strong>.</li></ul><hr><h3 id=3-conduct-regular-integrity-checks><strong>3. Conduct Regular Integrity Checks</strong><a hidden class=anchor aria-hidden=true href=#3-conduct-regular-integrity-checks>#</a></h3><ul><li>Schedule regular scans using <code>bpftool</code> to <strong>dump the list of loaded eBPF programs</strong>.</li><li>Compare (diff) with previous outputs to identify new or suspicious entries.</li><li>Focus especially on newly appeared <code>kprobe</code>, <code>tracepoint</code>, or unknown eBPF programs​ (<a href="https://redcanary.com/blog/threat-detection/ebpf-malware/#:~:text=Use%20,programs">redcanary.com</a>).</li><li>Regularly inspect <code>/sys/fs/bpf/</code> and <code>/sys/kernel/debug/kprobes/list</code> for unusual activity​ (<a href="https://redcanary.com/blog/threat-detection/ebpf-malware/#:~:text=Look%20for%20unexpected%20kprobes%20loaded%3A">redcanary.com</a>).</li></ul><hr><h3 id=4-prepare-forensic-capabilities><strong>4. Prepare Forensic Capabilities</strong><a hidden class=anchor aria-hidden=true href=#4-prepare-forensic-capabilities>#</a></h3><ul><li>Establish <strong>memory forensic procedures</strong> for critical servers.</li><li>Prepare hypervisor-based snapshots or remote memory dump capabilities.</li><li>Use tools like <strong>Volatility plugins</strong> to extract eBPF-related structures post-incident​ (<a href="https://www.scitepress.org/Papers/2024/124708/124708.pdf#:~:text=While%20these%20two%20tools%20provide,is%20believed%20to%20be%20secure">scitepress.org</a>).</li><li>Memory forensics acts as a <strong>last line of defense</strong> against stealthy eBPF backdoors.</li></ul><hr><h3 id=5-continuously-update-and-share-intelligence><strong>5. Continuously Update and Share Intelligence</strong><a hidden class=anchor aria-hidden=true href=#5-continuously-update-and-share-intelligence>#</a></h3><ul><li>Stay updated on the latest security blogs, conferences, and GitHub repositories.</li><li>Actively incorporate new IOCs (Indicators of Compromise) and detection rules.</li><li>Quickly analyze and reflect new backdoor variants or malware samples (e.g., updated BPFDoor variants) into internal security measures.</li></ul><blockquote><p><strong>Summary</strong>:<br>eBPF backdoor detection demands <strong>a proactive, multilayered defense</strong> combining real-time monitoring, post-incident validation, preventive hardening, and continuous intelligence updates.<br>Security professionals must leverage eBPF itself to <strong>watch the kernel from within</strong>, turning attackers&rsquo; tools into defenders&rsquo; shields.</p></blockquote><hr></div><footer class=post-footer><ul class=post-tags><li><a href=https://windshock.github.io/en/tags/ebpf/>EBPF</a></li><li><a href=https://windshock.github.io/en/tags/rootkit-detection/>Rootkit Detection</a></li><li><a href=https://windshock.github.io/en/tags/bpfdoor/>BPFDoor</a></li><li><a href=https://windshock.github.io/en/tags/kernel-security/>Kernel Security</a></li><li><a href=https://windshock.github.io/en/tags/tracee/>Tracee</a></li><li><a href=https://windshock.github.io/en/tags/lkrg/>LKRG</a></li><li><a href=https://windshock.github.io/en/tags/hypervisor-audit/>Hypervisor Audit</a></li><li><a href=https://windshock.github.io/en/tags/forensics/>Forensics</a></li></ul><nav class=paginav><a class=next href=https://windshock.github.io/en/post/2025-04-28-telecom-security-breach-analysis/><span class=title>Next »</span><br><span>In-Depth Report on Telecommunication Security: SKT Breach and Global Case Studies</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Detection Frameworks and Latest Methodologies for eBPF-Based Backdoors on x" href="https://x.com/intent/tweet/?text=Detection%20Frameworks%20and%20Latest%20Methodologies%20for%20eBPF-Based%20Backdoors&amp;url=https%3a%2f%2fwindshock.github.io%2fen%2fpost%2f2025-04-29-ebpf-backdoor-detection-framework%2f&amp;hashtags=eBPF%2cRootkitDetection%2cBPFDoor%2cKernelSecurity%2cTracee%2cLKRG%2cHypervisorAudit%2cForensics"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Detection Frameworks and Latest Methodologies for eBPF-Based Backdoors on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwindshock.github.io%2fen%2fpost%2f2025-04-29-ebpf-backdoor-detection-framework%2f&amp;title=Detection%20Frameworks%20and%20Latest%20Methodologies%20for%20eBPF-Based%20Backdoors&amp;summary=Detection%20Frameworks%20and%20Latest%20Methodologies%20for%20eBPF-Based%20Backdoors&amp;source=https%3a%2f%2fwindshock.github.io%2fen%2fpost%2f2025-04-29-ebpf-backdoor-detection-framework%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Detection Frameworks and Latest Methodologies for eBPF-Based Backdoors on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwindshock.github.io%2fen%2fpost%2f2025-04-29-ebpf-backdoor-detection-framework%2f&title=Detection%20Frameworks%20and%20Latest%20Methodologies%20for%20eBPF-Based%20Backdoors"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Detection Frameworks and Latest Methodologies for eBPF-Based Backdoors on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwindshock.github.io%2fen%2fpost%2f2025-04-29-ebpf-backdoor-detection-framework%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Detection Frameworks and Latest Methodologies for eBPF-Based Backdoors on whatsapp" href="https://api.whatsapp.com/send?text=Detection%20Frameworks%20and%20Latest%20Methodologies%20for%20eBPF-Based%20Backdoors%20-%20https%3a%2f%2fwindshock.github.io%2fen%2fpost%2f2025-04-29-ebpf-backdoor-detection-framework%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Detection Frameworks and Latest Methodologies for eBPF-Based Backdoors on telegram" href="https://telegram.me/share/url?text=Detection%20Frameworks%20and%20Latest%20Methodologies%20for%20eBPF-Based%20Backdoors&amp;url=https%3a%2f%2fwindshock.github.io%2fen%2fpost%2f2025-04-29-ebpf-backdoor-detection-framework%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Detection Frameworks and Latest Methodologies for eBPF-Based Backdoors on ycombinator" href="https://news.ycombinator.com/submitlink?t=Detection%20Frameworks%20and%20Latest%20Methodologies%20for%20eBPF-Based%20Backdoors&u=https%3a%2f%2fwindshock.github.io%2fen%2fpost%2f2025-04-29-ebpf-backdoor-detection-framework%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://windshock.github.io/en/>Code Before Breach</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>function loadGiscus(e){document.querySelectorAll('.giscus-frame, script[src*="giscus.app"]').forEach(e=>e.remove());const t=document.createElement("script");t.src="https://giscus.app/client.js",t.setAttribute("data-repo","windshock/windshock.github.io"),t.setAttribute("data-repo-id","MDEwOlJlcG9zaXRvcnkxODQ2MDMyMTk="),t.setAttribute("data-category","General"),t.setAttribute("data-category-id","DIC_kwDOCwDSU84CoqLg"),t.setAttribute("data-mapping","pathname"),t.setAttribute("data-reactions-enabled","1"),t.setAttribute("data-theme",e),t.setAttribute("data-lang","en"),t.setAttribute("data-input-position","bottom"),t.setAttribute("data-loading","lazy"),t.crossOrigin="anonymous",t.async=!0,document.body.appendChild(t)}const currentTheme=document.body.classList.contains("dark")?"dark":"light";loadGiscus(currentTheme);const observer=new MutationObserver(()=>{const e=document.body.classList.contains("dark")?"dark":"light";loadGiscus(e)});observer.observe(document.body,{attributes:!0,attributeFilter:["class"]})</script><script>function initSwiperIfNeeded(){if(typeof Swiper=="undefined")return setTimeout(initSwiperIfNeeded,50);document.querySelector(".swiper")?(new Swiper(".swiper",{slidesPerView:1.2,spaceBetween:16,loop:!0,preloadImages:!1,lazy:{loadOnTransitionStart:!0,loadPrevNext:!0},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{768:{slidesPerView:2.5},1024:{slidesPerView:3.2}}}),document.querySelectorAll("img.swiper-lazy").forEach(e=>{e.src=e.dataset.src})):setTimeout(initSwiperIfNeeded,100)}initSwiperIfNeeded()</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>